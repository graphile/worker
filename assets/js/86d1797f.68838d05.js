"use strict";(self.webpackChunkgraphile_worker=self.webpackChunkgraphile_worker||[]).push([[979],{9916:(e,r,n)=>{n.d(r,{xA:()=>p,yg:()=>y});var t=n(3696);function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=t.createContext({}),c=function(e){var r=t.useContext(s),n=r;return e&&(n="function"==typeof e?e(r):l(l({},r),e)),n},p=function(e){var r=c(e.components);return t.createElement(s.Provider,{value:r},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},h=t.forwardRef((function(e,r){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),h=o,y=u["".concat(s,".").concat(h)]||u[h]||d[h]||a;return n?t.createElement(y,l(l({ref:r},p),{},{components:n})):t.createElement(y,l({ref:r},p))}));function y(e,r){var n=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=h;var i={};for(var s in r)hasOwnProperty.call(r,s)&&(i[s]=r[s]);i.originalType=e,i[u]="string"==typeof e?e:o,l[1]=i;for(var c=2;c<a;c++)l[c]=n[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6617:(e,r,n)=>{n.r(r),n.d(r,{contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>s});var t=n(8102),o=(n(3696),n(9916));const a={},l="Pool error handling",i={type:"mdx",permalink:"/errors/peh",source:"@site/src/pages/errors/peh.md",title:"Pool error handling",description:"You're likely here because you received an error such as:",frontMatter:{}},s=[],c={toc:s},p="wrapper";function u(e){let{components:r,...n}=e;return(0,o.yg)(p,(0,t.A)({},c,n,{components:r,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"pool-error-handling"},"Pool error handling"),(0,o.yg)("p",null,"You're likely here because you received an error such as:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"Your pool doesn't have error handlers! See: https://err.red/wpeh\n")),(0,o.yg)("p",null,"This means you've passed your own\n",(0,o.yg)("a",{parentName:"p",href:"https://node-postgres.com/apis/pool"},"pg.Pool instance")," to Graphile Worker, but\nthat pool did not have error handling installed."),(0,o.yg)("p",null,"If an error occurs on the pool and there is no event handler installed Node\nwould exit\n",(0,o.yg)("a",{parentName:"p",href:"https://nodejs.org/api/events.html#error-events"},"as described in the Node.js docs"),".\nYou get a network interruption, and your Worker might crash!"),(0,o.yg)("p",null,"Don't worry, we've installed error handlers for you, but that's not ideal - you\nshould be handling this yourself. To do so, use code like this:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-ts"},'// Handle errors on the pool directly\npgPool.on("error", (err) => {\n  console.error(`PostgreSQL idle client generated error: ${err.message}`);\n});\n// Handle errors on the client when it\'s checked out of the pool but isn\'t\n// actively being used\npgPool.on("connect", (client) => {\n  client.on("error", (err) => {\n    console.error(`PostgreSQL active client generated error: ${err.message}`);\n  });\n});\n')),(0,o.yg)("p",null,"Your code just needs to make sure the 'error' events on pool and client have\nhandlers installed; the handlers don't actually have to ",(0,o.yg)("em",{parentName:"p"},"do")," anything - they\ncould be NO-OPs."),(0,o.yg)("p",null,"Typically these kinds of errors would occur when e.g. the connection between\nNode.js and PostgreSQL is interrupted (including when the PostgreSQL server\nshuts down). In these cases since the client is likely not actively being\n",(0,o.yg)("inlineCode",{parentName:"p"},"await"),"-ed the error will have no handler, and will result in a process exit if\nunhandled."))}u.isMDXComponent=!0}}]);